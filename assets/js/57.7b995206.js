(window.webpackJsonp=window.webpackJsonp||[]).push([[57],{744:function(s,t,a){"use strict";a.r(t);var n=a(15),r=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"知识扩展-rancher前端服务发布"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#知识扩展-rancher前端服务发布"}},[s._v("#")]),s._v(" 知识扩展-Rancher前端服务发布")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/HerryLo",target:"_blank",rel:"noopener noreferrer"}},[s._v("作者：HerryLo"),a("OutboundLink")],1)]),s._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/AttemptWeb/Record/issues/34",target:"_blank",rel:"noopener noreferrer"}},[s._v("博客原文链接"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("项目中用到rancher发布前端代码，我自己参与了一次构建，遇到了很多的问题，不过一一解决了，用闲暇的时间，将遇到的问题记下来，也算是一次复盘了。")]),s._v(" "),a("p",[s._v("rancher是一个开源的企业级容器管理平台，重点“容器管理”，可以极大的简化容器管理的复杂度（相对于K8s）,它是对于k8s容器引擎的封装，有兴趣可以看看官方文档。")]),s._v(" "),a("p",[a("a",{attrs:{name:"M0lpc"}})]),s._v(" "),a("h3",{attrs:{id:"上传镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#上传镜像"}},[s._v("#")]),s._v(" 上传镜像")]),s._v(" "),a("p",[s._v("需要先"),a("strong",[s._v("安装docker")]),s._v("，确保docker是可以使用的。下面是"),a("code",[s._v("Dockerfile")]),s._v("文件和"),a("code",[s._v("default.conf")]),s._v("文件")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v("  nginx")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" ./build /usr/share/nginx/html/")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" ./default.conf /etc/nginx/conf.d/")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 80")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[a("code",[s._v("Dockerfile")]),s._v("文件主要用于docker镜像的创建；"),a("br"),a("code",[s._v("FROM nginx")]),s._v("：FROM指令初始化一个新的构建阶段，并为后续指令设置"),a("a",{attrs:{href:"https://docs.docker.com/glossary/#base_image",target:"_blank",rel:"noopener noreferrer"}},[s._v("基础镜像"),a("OutboundLink")],1),s._v("，这里的基础镜像是nginx；"),a("br"),a("code",[s._v("COPY ./build /usr/share/nginx/html/")]),s._v("："),a("code",[s._v("./build")]),s._v("是前端打包之后的文件地址，将它复制到nginx的html目录下；"),a("br"),a("code",[s._v("COPY ./default.conf /etc/nginx/conf.d/")]),s._v("："),a("code",[s._v("./default.conf")]),s._v("是nginx配置文件, 将它复制到nginx的conf.d目录下；"),a("br"),a("code",[s._v("EXPOSE 80")]),s._v("：监听80端口；")]),s._v(" "),a("p",[s._v("通过如下命令行打包代码（实际代码根据自己项目而定）：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("// 前端本地打包\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" run build:prod\n\n// 移除之前旧的镜像\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" rmi xx.harbor.com:10443/xx/front-web-project:1.0.0\n\n// 构建镜像\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build -f Dockerfile -t xx.harbor.com:10443/xx/front-web-project:1.0.0 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n\n// push 镜像到镜像仓库\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" push xx.harbor.com:10443/xx/front-web-project:1.0.0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("镜像仓库是提前构建好的，可以找运维工程师确认。我上面使用到的是"),a("code",[s._v("harbor")]),s._v("镜像存储库，这个是运维工程师搭建好的，我这边可以直接使用。镜像名和tag根据自己项目实际来。")]),s._v(" "),a("p",[a("a",{attrs:{name:"bvSep"}})]),s._v(" "),a("h3",{attrs:{id:"nginx配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx配置"}},[s._v("#")]),s._v(" Nginx配置")]),s._v(" "),a("p",[s._v("下面就是nginx配置文件 "),a("code",[s._v("default.conf")]),s._v(" ，由于是前端项目，nginx主要在这里做的就是静态资源服务器，接口代理。")]),s._v(" "),a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add_header")]),s._v(" Access-Control-Allow-Origin *")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add_header")]),s._v(" Access-Control-Allow-Credentials true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add_header")]),s._v(" Access-Control-Allow-Methods *")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("client_max_body_size")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000M")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n  "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("   /usr/share/nginx/html/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v("  index.html index.htm")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try_files")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),s._v(" /index.html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[s._v("nginx配置文件根据自己的实际需求编写，更多的配置也可以在这里继续添加（比例"),a("strong",[s._v("接口代理")]),s._v("，"),a("strong",[s._v("负载均衡")]),s._v("等）。")]),s._v(" "),a("p",[a("a",{attrs:{name:"bas8Y"}})]),s._v(" "),a("h3",{attrs:{id:"工作负载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#工作负载"}},[s._v("#")]),s._v(" 工作负载")]),s._v(" "),a("p",[s._v("rancher是一个容器管理平台，是k8s的二次封装，提供更丰富的功能，有兴趣的同学，可以看看 "),a("a",{attrs:{href:"https://www.rancher.cn/",target:"_blank",rel:"noopener noreferrer"}},[s._v("官网"),a("OutboundLink")],1),s._v(" 的相关资料。在rancher里工作负载是一个对象，包括pod以及部署应用程序所需的其他文件和信息。")]),s._v(" "),a("p",[s._v("以下是rancher中 工作负载服务的创建过程："),a("br"),a("img",{attrs:{src:"/image/DA89955.png",alt:""}}),a("br"),s._v("点击部署服务，进入到创建工作负载界面："),a("br"),a("img",{attrs:{src:"/image/F6FB7E.png",alt:""}}),a("br"),s._v("Docker镜像地址是你已经上传的 **前端镜像地址 **，主机端口需要 **找运维确认端口 **，命名空间可选中已有的。容器端口一般都是 "),a("code",[s._v("80")]),s._v("，这和你的 "),a("code",[s._v("default.conf")]),s._v("配置端口相关。"),a("strong",[s._v("以上填写完成之后，滑动到底部，点击升级按钮")]),s._v("。")]),s._v(" "),a("p",[s._v("点击进入创建完成的工作负载中，"),a("strong",[s._v("如果pods中存在正常running的pod实例，既是创建成功")]),s._v("。如果存在其他问题，可以参考下面 "),a("strong",[s._v("出现的问题")]),s._v("，进行相关问题的排查。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/image/BB778B0.png",alt:""}})]),s._v(" "),a("p",[s._v("创建发布成功后，既可通过ip+端口访问前端服务，如果能访问成功代表部署的没有问题。")]),s._v(" "),a("p",[a("a",{attrs:{name:"Lzqdo"}})]),s._v(" "),a("h3",{attrs:{id:"出现的问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#出现的问题"}},[s._v("#")]),s._v(" 出现的问题")]),s._v(" "),a("p",[s._v("以下问题是在实际使用发现的问题，将它们记录下来；")]),s._v(" "),a("p",[a("a",{attrs:{name:"mrqcE"}})]),s._v(" "),a("h4",{attrs:{id:"镜像构建服务无法成功-提示是失败的构建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#镜像构建服务无法成功-提示是失败的构建"}},[s._v("#")]),s._v(" 镜像构建服务无法成功，提示是失败的构建")]),s._v(" "),a("p",[a("strong",[s._v("优先查看日志信息，根据日志信息提示排查问题")]),s._v("。例如：如果提示镜像构建服务时报错，记得排查前端静态资源文件打包中，"),a("strong",[s._v("nginx配置文件编写存在问题")]),s._v("，"),a("strong",[s._v("相关的Dockfile文件配置信息是否正常")]),s._v("。")]),s._v(" "),a("p",[a("a",{attrs:{name:"jIHc3"}})]),s._v(" "),a("h4",{attrs:{id:"镜像构建服务成功后-页面依然无法访问"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#镜像构建服务成功后-页面依然无法访问"}},[s._v("#")]),s._v(" "),a("strong",[s._v("镜像构建服务成功后，页面依然无法访问")])]),s._v(" "),a("p",[a("strong",[s._v("查看日志信息，查看是否有提示信息")]),s._v("。如果存在提示信息，根据提示排查问题；"),a("br"),s._v("在保证服务启动正常，nginx配置正常的前提下，与相关人员确认，服务器IP、端口号，是否正常开启。")]),s._v(" "),a("p",[a("a",{attrs:{name:"NBJbN"}})]),s._v(" "),a("h4",{attrs:{id:"构建服务成功-页面访问不是目标文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#构建服务成功-页面访问不是目标文件"}},[s._v("#")]),s._v(" "),a("strong",[s._v("构建服务成功，页面访问不是目标文件")])]),s._v(" "),a("p",[s._v("确认nginx配置信息是否生效，是否有被其他文件覆盖；并确认前端资源文件上传到了指定目录，存在相关文件目录。")]),s._v(" "),a("p",[a("a",{attrs:{name:"SXMOZ"}})]),s._v(" "),a("h4",{attrs:{id:"构建服务成功-页面访问正常-接口代理异常"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#构建服务成功-页面访问正常-接口代理异常"}},[s._v("#")]),s._v(" "),a("strong",[s._v("构建服务成功，页面访问正常，接口代理异常")])]),s._v(" "),a("p",[s._v("**查看访问日志信息，是否存在相关请求提示信息。**确认nginx配置接口代理编写正确，不存在异常错误；再打开命令行窗口，尝试通过 "),a("code",[s._v("curl [目标服务接口地址]")]),s._v("，确认接口ip是否可以正常访问。")]),s._v(" "),a("p",[a("a",{attrs:{name:"GokSd"}})]),s._v(" "),a("h4",{attrs:{id:"代理文件、接口地址访问不稳定"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#代理文件、接口地址访问不稳定"}},[s._v("#")]),s._v(" 代理文件、接口地址访问不稳定")]),s._v(" "),a("p",[s._v("确认网络模式，IP地址是否为相同模式下的IP和端口。")]),s._v(" "),a("p",[a("strong",[s._v("ps")]),s._v(": 微信公众号：Yopai，有兴趣的可以关注，每周不定期更新。不断分享，不断进步")]),s._v(" "),a("p",[a("img",{attrs:{src:"/webChat1.png",alt:""}})])])}),[],!1,null,null,null);t.default=r.exports}}]);